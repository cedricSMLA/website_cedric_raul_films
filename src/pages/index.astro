---
import Base from '@/layouts/Base.astro';
import Section from '@/components/Section.astro';
import Button from '@/components/Button.astro';
import Card from '@/components/Card.astro';
import BadgePrice from '@/components/BadgePrice.astro';
import VideoEmbed from '@/components/VideoEmbed.astro';
import { getCollection } from 'astro:content';

const portfolioItems = await getCollection('portfolio');
const featuredItems = portfolioItems
  .filter(item => item.data.featured)
  .slice(0, 5)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const photographes = await getCollection('photographes');
const featuredPhotographes = photographes.filter(p => p.data.featured).slice(0, 3);
---

<Base 
  title="Cédric Raúl Films - Vidéaste mariage cinématographique Côte d'Azur"
  description="Vidéaste spécialisé dans les films de mariage cinématographiques et les vidéos corporate avec drone FPV sur la Côte d'Azur."
>
  <!-- Hero Section -->
  <Section class="relative min-h-screen flex items-center" padding="xl">
    <!-- Hero Image Background -->
    <div class="absolute inset-0">
      <img 
        src="/media/photo/02.jpg" 
        alt="Cédric Raúl Films - Vidéaste mariage cinématographique"
        class="w-full h-full object-cover"
        loading="eager"
      />
      <div class="absolute inset-0 bg-black/50"></div>
    </div>
    
    <!-- Hero Content -->
    <div class="relative z-10 text-center max-w-4xl mx-auto">
      <h1 class="text-5xl md:text-7xl font-bold text-warm-ivory mb-6 animate-fade-in">
        Votre mariage,<br>
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-accent-blue to-accent-purple">
          une œuvre cinématographique
        </span>
      </h1>
      
      <p class="text-xl md:text-2xl text-warm-beige mb-8 animate-slide-up">
        Vidéaste spécialisé dans les films de mariage haut de gamme avec drone FPV sur la Côte d'Azur
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center animate-slide-up">
        <Button href="#contact" size="lg">
          Vérifier ma date
        </Button>
        <Button href="/contact" variant="outline" size="lg">
          Réserver un appel
        </Button>
      </div>
    </div>
  </Section>

  <!-- Video Showreel Section -->
  <Section background="dark" padding="lg">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-bold text-warm-ivory mb-4">
          Découvrez notre univers
        </h2>
        <p class="text-lg text-warm-beige">
          Un aperçu de notre savoir-faire cinématographique
        </p>
      </div>
      
      <div class="relative group" id="showreel-container">
        <video 
          id="showreel-video"
          muted
          loop
          playsinline
          disablepictureinpicture
          controlslist="nodownload nofullscreen noremoteplayback"
          poster="/media/hero-poster.jpg"
          class="w-full aspect-video object-cover rounded-lg"
          preload="metadata"
        >
          <source src="/media/video/melissa_cedric_insta.mp4" type="video/mp4">
        </video>
        
        <!-- Custom mute/unmute button - appears on hover -->
        <button 
          id="mute-toggle"
          class="absolute top-6 right-6 w-14 h-14 bg-black/40 hover:bg-black/70 backdrop-blur-sm rounded-full flex items-center justify-center transition-all duration-300 opacity-0 group-hover:opacity-100 border border-white/20 hover:border-white/40"
          aria-label="Activer/Désactiver le son"
        >
          <svg id="mute-icon" class="w-6 h-6 text-white/90" fill="currentColor" viewBox="0 0 28 24">
            <path d="M3 9v6h4l5 5V4L7 9H3z"/>
            <path d="m20 9 2.5-2.5 1.5 1.5-2.5 2.5 2.5 2.5-1.5 1.5-2.5-2.5-2.5 2.5-1.5-1.5 2.5-2.5-2.5-2.5 1.5-1.5 2.5 2.5z"/>
          </svg>
          <svg id="unmute-icon" class="w-6 h-6 text-white/90 hidden" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77 0-4.28-2.99-7.86-7-8.77zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM3 9v6h4l5 5V4L7 9H3z"/>
          </svg>
        </button>
      </div>
    </div>
  </Section>

  <!-- Portfolio Teaser -->
  <Section background="dark" padding="xl">
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-5xl font-bold text-warm-ivory mb-6">
        Nos dernières créations
      </h2>
      <p class="text-xl text-warm-beige max-w-2xl mx-auto">
        Découvrez une sélection de nos films de mariage les plus récents
      </p>
    </div>
    
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
      {featuredItems.map((item) => (
        <Card href={`/portfolio/${item.slug}`} class="group">
          <VideoEmbed 
            youtubeId={item.data.youtubeId}
            title={item.data.title}
            class="aspect-video"
          />
          <div class="p-6">
            <h3 class="text-xl font-semibold text-warm-ivory mb-2 group-hover:text-warm-beige transition-colors">
              {item.data.title}
            </h3>
            <p class="text-warm-beige text-sm mb-3">{item.data.description}</p>
            <div class="flex flex-wrap gap-2">
              {item.data.tags.map(tag => (
                <span class="px-2 py-1 bg-warm-beige/10 text-warm-beige text-xs rounded">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        </Card>
      ))}
    </div>
    
    <div class="text-center">
      <Button href="/portfolio" variant="outline" size="lg">
        Voir tout le portfolio
      </Button>
    </div>
  </Section>

  <!-- LOREN Bandeau -->
  <Section background="gradient" padding="lg">
    <div class="text-center">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-bold text-warm-ivory mb-6">
          Forfait LOREN
        </h2>
        <p class="text-xl text-warm-beige mb-8">
          Notre formule complète pour immortaliser votre jour J avec élégance et emotion
        </p>
        
        <div class="flex flex-col sm:flex-row items-center justify-center gap-6 mb-8">
          <BadgePrice price="2900€ TTC" />
          <Button href="/loren" size="lg">
            Découvrir LOREN
          </Button>
        </div>
        
        <div class="grid md:grid-cols-3 gap-6 text-center">
          <div class="p-4">
            <div class="w-12 h-12 bg-accent-blue rounded-full flex items-center justify-center mx-auto mb-3">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="font-semibold text-warm-ivory mb-2">Film complet</h3>
            <p class="text-warm-beige text-sm">Couverture intégrale de votre journée</p>
          </div>
          
          <div class="p-4">
            <div class="w-12 h-12 bg-accent-purple rounded-full flex items-center justify-center mx-auto mb-3">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
              </svg>
            </div>
            <h3 class="font-semibold text-warm-ivory mb-2">Drone FPV</h3>
            <p class="text-warm-beige text-sm">Prises de vue aériennes spectaculaires</p>
          </div>
          
          <div class="p-4">
            <div class="w-12 h-12 bg-accent-blue rounded-full flex items-center justify-center mx-auto mb-3">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
              </svg>
            </div>
            <h3 class="font-semibold text-warm-ivory mb-2">Post-production</h3>
            <p class="text-warm-beige text-sm">Montage professionnel et étalonnage</p>
          </div>
        </div>
      </div>
    </div>
  </Section>

  <!-- Photographes Teaser -->
  <Section background="dark" padding="xl">
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-5xl font-bold text-warm-ivory mb-6">
        Nos photographes partenaires
      </h2>
      <p class="text-xl text-warm-beige max-w-2xl mx-auto">
        Collaborez avec les meilleurs photographes pour un duo vidéo/photo parfait
      </p>
    </div>
    
    <div class="grid md:grid-cols-3 gap-8 mb-12">
      {featuredPhotographes.map((photographe) => (
        <Card href={`/photographes#${photographe.slug}`}>
          <img 
            src={photographe.data.images[0]} 
            alt={photographe.data.name}
            class="w-full h-64 object-cover"
            loading="lazy"
          />
          <div class="p-6">
            <h3 class="text-xl font-semibold text-warm-ivory mb-2">{photographe.data.name}</h3>
            <p class="text-accent-blue text-sm font-medium mb-3">{photographe.data.speciality}</p>
            <p class="text-warm-beige text-sm">{photographe.data.bio}</p>
          </div>
        </Card>
      ))}
    </div>
    
    <div class="text-center">
      <Button href="/photographes" variant="outline" size="lg">
        Voir tous nos partenaires
      </Button>
    </div>
  </Section>

  <!-- Drone FPV Bandeau -->
  <Section background="gradient" padding="md">
    <div class="text-center max-w-4xl mx-auto">
      <h2 class="text-2xl md:text-3xl font-bold text-warm-ivory mb-4">
        Drone FPV Certifié
      </h2>
      <p class="text-warm-beige">
        Pilote certifié DGAC, assurances complètes. Prises de vue aériennes autorisées et sécurisées.
        <a href="/drone-fpv" class="text-warm-ivory underline ml-2">En savoir plus</a>
      </p>
    </div>
  </Section>

  <!-- Contact CTA -->
  <Section background="dark" padding="xl" class="border-t border-warm-beige/10" id="contact">
    <div class="text-center max-w-3xl mx-auto">
      <h2 class="text-4xl md:text-5xl font-bold text-warm-ivory mb-6">
        Prêt à créer votre film de mariage ?
      </h2>
      <p class="text-xl text-warm-beige mb-8">
        Contactez-nous pour discuter de votre projet et vérifier nos disponibilités
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <Button href="/contact" size="lg">
          Demander un devis
        </Button>
        <Button href="tel:+33123456789" variant="outline" size="lg">
          Appelez-nous
        </Button>
      </div>
    </div>
  </Section>
</Base>

<script>
  // Video showreel functionality
  document.addEventListener('DOMContentLoaded', function() {
    const video = document.getElementById('showreel-video') as HTMLVideoElement;
    const container = document.getElementById('showreel-container');
    const muteToggle = document.getElementById('mute-toggle');
    const muteIcon = document.getElementById('mute-icon');
    const unmuteIcon = document.getElementById('unmute-icon');
    
    if (!video || !container || !muteToggle) return;
    
    let hasStartedPlaying = false;
    
    // Intersection Observer for scroll-triggered video
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !hasStartedPlaying) {
          // Auto-play when in view (silent)
          video.muted = true;
          video.play().catch(() => {
            console.log('Autoplay prevented by browser');
          });
          hasStartedPlaying = true;
        }
      });
    }, {
      threshold: 0.3, // Trigger when 30% of video is visible
      rootMargin: '0px'
    });
    
    observer.observe(container);
    
    // Mute/unmute toggle
    muteToggle.addEventListener('click', function() {
      video.muted = !video.muted;
      
      if (video.muted) {
        muteIcon?.classList.remove('hidden');
        unmuteIcon?.classList.add('hidden');
      } else {
        muteIcon?.classList.add('hidden');
        unmuteIcon?.classList.remove('hidden');
      }
    });
    
    // Smooth scroll reveal animation
    const revealOnScroll = () => {
      const elements = document.querySelectorAll('[data-reveal]');
      elements.forEach(element => {
        const elementTop = element.getBoundingClientRect().top;
        const elementVisible = 150;
        
        if (elementTop < window.innerHeight - elementVisible) {
          element.classList.add('animate-slide-up');
        }
      });
    };
    
    window.addEventListener('scroll', revealOnScroll);
    revealOnScroll(); // Initial check
  });
</script>